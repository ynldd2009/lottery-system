{% extends "base.html" %}

{% block title %}æ•°æ®åˆ†æ - å½©ç¥¨åˆ†æé¢„æµ‹ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ“Š æ•°æ®åˆ†æ</h1>
    <p>å¯¹å†å²å½©ç¥¨æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ</p>
</div>

<div class="card">
    <div class="card-header">
        <h2>æ•°æ®å‡†å¤‡</h2>
    </div>
    <div class="card-body">
        <button id="generateDataBtn" class="btn btn-primary">ç”Ÿæˆæ ·æœ¬æ•°æ® (100æ¡)</button>
        <span id="dataStatus" class="status-text"></span>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>åˆ†æç»“æœ</h2>
    </div>
    <div class="card-body">
        <button id="analyzeBtn" class="btn btn-success">å¼€å§‹åˆ†æ</button>
        <div id="analysisResults" class="results-container"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('generateDataBtn').addEventListener('click', async function() {
    this.disabled = true;
    this.textContent = 'ç”Ÿæˆä¸­...';
    
    try {
        const response = await fetch('/api/generate-sample-data', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({num_draws: 100})
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('dataStatus').textContent = `âœ“ å·²ç”Ÿæˆ ${data.count} æ¡æ•°æ®`;
            document.getElementById('dataStatus').className = 'status-text success';
        } else {
            alert('ç”Ÿæˆå¤±è´¥: ' + data.error);
        }
    } catch (error) {
        alert('é”™è¯¯: ' + error.message);
    } finally {
        this.disabled = false;
        this.textContent = 'ç”Ÿæˆæ ·æœ¬æ•°æ® (100æ¡)';
    }
});

document.getElementById('analyzeBtn').addEventListener('click', async function() {
    this.disabled = true;
    this.textContent = 'åˆ†æä¸­...';
    
    try {
        const response = await fetch('/api/analyze', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        });
        
        const data = await response.json();
        if (data.success) {
            displayResults(data.results);
        } else {
            alert('åˆ†æå¤±è´¥: ' + data.error);
        }
    } catch (error) {
        alert('é”™è¯¯: ' + error.message);
    } finally {
        this.disabled = false;
        this.textContent = 'å¼€å§‹åˆ†æ';
    }
});

function displayResults(results) {
    const container = document.getElementById('analysisResults');
    
    let html = '<div class="analysis-grid">';
    
    // Frequency
    if (results.frequency) {
        html += '<div class="analysis-section">';
        html += '<h3>é¢‘ç‡åˆ†æ</h3>';
        html += '<div class="number-grid">';
        const topFreq = Object.entries(results.frequency).slice(0, 10);
        topFreq.forEach(([num, freq]) => {
            html += `<div class="number-item"><span class="number">${num}</span><span class="freq">${freq}æ¬¡</span></div>`;
        });
        html += '</div></div>';
    }
    
    // Hot numbers
    if (results.hot_numbers) {
        html += '<div class="analysis-section">';
        html += '<h3>çƒ­å·</h3>';
        html += '<div class="number-list">';
        results.hot_numbers.forEach(num => {
            html += `<span class="badge badge-hot">${num}</span>`;
        });
        html += '</div></div>';
    }
    
    // Cold numbers
    if (results.cold_numbers) {
        html += '<div class="analysis-section">';
        html += '<h3>å†·å·</h3>';
        html += '<div class="number-list">';
        results.cold_numbers.forEach(num => {
            html += `<span class="badge badge-cold">${num}</span>`;
        });
        html += '</div></div>';
    }
    
    // Patterns
    if (results.patterns) {
        html += '<div class="analysis-section">';
        html += '<h3>æ¨¡å¼åˆ†æ</h3>';
        html += '<ul>';
        for (const [key, value] of Object.entries(results.patterns)) {
            html += `<li><strong>${key}:</strong> ${JSON.stringify(value)}</li>`;
        }
        html += '</ul></div>';
    }
    
    html += '</div>';
    container.innerHTML = html;
}
</script>
{% endblock %}
